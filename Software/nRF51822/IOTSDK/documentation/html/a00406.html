<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 IoT SDK: Application IoT DFU</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 IoT SDK
   &#160;<span id="projectnumber">v0.9.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="usergroup0.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00406.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Application IoT DFU<div class="ingroups"><a class="el" href="a00450.html">IoT DFU</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>API for upgrading firmware in user application.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00130.html">iot_dfu_firmware_block_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Description of single block of firmware.  <a href="a00130.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00131.html">iot_dfu_firmware_desc_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Description of the new firmware that has been written into flash memory.  <a href="a00131.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga8996135a268d6b7f19c520db0cce6ff4"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00406.html#ga8996135a268d6b7f19c520db0cce6ff4">iot_dfu_callback_t</a> )(uint32_t result, <a class="el" href="a00406.html#ga26d3f610b0a69e4fdbb41b75fbf10cb6">iot_dfu_evt_t</a> evt)</td></tr>
<tr class="memdesc:ga8996135a268d6b7f19c520db0cce6ff4"><td class="mdescLeft">&#160;</td><td class="mdescRight">IOT DFU module's application callback.  <a href="#ga8996135a268d6b7f19c520db0cce6ff4">More...</a><br/></td></tr>
<tr class="separator:ga8996135a268d6b7f19c520db0cce6ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga26d3f610b0a69e4fdbb41b75fbf10cb6"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00406.html#ga26d3f610b0a69e4fdbb41b75fbf10cb6">iot_dfu_evt_t</a> { <br/>
&#160;&#160;<a class="el" href="a00406.html#gga26d3f610b0a69e4fdbb41b75fbf10cb6ad7ab29e6a9c60bed47a50e321e6aa150">IOT_DFU_WRITE_COMPLETE</a>, 
<br/>
&#160;&#160;<a class="el" href="a00406.html#gga26d3f610b0a69e4fdbb41b75fbf10cb6afefd0226cc6e6d65be6af5a4a3ce61ac">IOT_DFU_ERROR</a>
<br/>
 }</td></tr>
<tr class="memdesc:ga26d3f610b0a69e4fdbb41b75fbf10cb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">IoT DFU module's events.  <a href="a00406.html#ga26d3f610b0a69e4fdbb41b75fbf10cb6">More...</a><br/></td></tr>
<tr class="separator:ga26d3f610b0a69e4fdbb41b75fbf10cb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6f7d51e2bc30b7a77152cf42defc887d"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00406.html#ga6f7d51e2bc30b7a77152cf42defc887d">iot_dfu_init</a> (<a class="el" href="a00406.html#ga8996135a268d6b7f19c520db0cce6ff4">iot_dfu_callback_t</a> cb)</td></tr>
<tr class="memdesc:ga6f7d51e2bc30b7a77152cf42defc887d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing IOT DFU module.  <a href="#ga6f7d51e2bc30b7a77152cf42defc887d">More...</a><br/></td></tr>
<tr class="separator:ga6f7d51e2bc30b7a77152cf42defc887d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa40b221af173bef353117211434da8cb"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00406.html#gaa40b221af173bef353117211434da8cb">iot_dfu_file_create</a> (<a class="el" href="a00402.html#ga8561f768e748c58a7049760265a43812">iot_file_t</a> **pp_file)</td></tr>
<tr class="memdesc:gaa40b221af173bef353117211434da8cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for creating a PStorage IoT File reference for flash operations and setting start address of PStorage File.  <a href="#gaa40b221af173bef353117211434da8cb">More...</a><br/></td></tr>
<tr class="separator:gaa40b221af173bef353117211434da8cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaadbe1106a191a7c388ec892c7741c273"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00406.html#gaadbe1106a191a7c388ec892c7741c273">iot_dfu_firmware_validate</a> (<a class="el" href="a00131.html">iot_dfu_firmware_desc_t</a> *p_firmware_desc)</td></tr>
<tr class="memdesc:gaadbe1106a191a7c388ec892c7741c273"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating the CRC of the received image.  <a href="#gaadbe1106a191a7c388ec892c7741c273">More...</a><br/></td></tr>
<tr class="separator:gaadbe1106a191a7c388ec892c7741c273"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae0963941e3ae5cb8df975c2be3cc857a"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00406.html#gae0963941e3ae5cb8df975c2be3cc857a">iot_dfu_firmware_apply</a> (<a class="el" href="a00131.html">iot_dfu_firmware_desc_t</a> *p_firmware_desc)</td></tr>
<tr class="memdesc:gae0963941e3ae5cb8df975c2be3cc857a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for rebooting device and trigger bootloader to swap the new firmware.  <a href="#gae0963941e3ae5cb8df975c2be3cc857a">More...</a><br/></td></tr>
<tr class="separator:gae0963941e3ae5cb8df975c2be3cc857a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>API for upgrading firmware in user application. </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga8996135a268d6b7f19c520db0cce6ff4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* iot_dfu_callback_t)(uint32_t result, <a class="el" href="a00406.html#ga26d3f610b0a69e4fdbb41b75fbf10cb6">iot_dfu_evt_t</a> evt)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IOT DFU module's application callback. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">result</td><td>Result of the received event. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>Event from IoT DFU module.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">None.</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="ga26d3f610b0a69e4fdbb41b75fbf10cb6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00406.html#ga26d3f610b0a69e4fdbb41b75fbf10cb6">iot_dfu_evt_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IoT DFU module's events. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="gga26d3f610b0a69e4fdbb41b75fbf10cb6ad7ab29e6a9c60bed47a50e321e6aa150"></a>IOT_DFU_WRITE_COMPLETE</em>&nbsp;</td><td class="fielddoc">
<p>Write operation finishes with success. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="gga26d3f610b0a69e4fdbb41b75fbf10cb6afefd0226cc6e6d65be6af5a4a3ce61ac"></a>IOT_DFU_ERROR</em>&nbsp;</td><td class="fielddoc">
<p>DFU event indicating that an error occurs during update. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaa40b221af173bef353117211434da8cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t iot_dfu_file_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00402.html#ga8561f768e748c58a7049760265a43812">iot_file_t</a> **&#160;</td>
          <td class="paramname"><em>pp_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for creating a PStorage IoT File reference for flash operations and setting start address of PStorage File. </p>
<dl class="section note"><dt>Note</dt><dd>Application should ensure that correct word sized alignment is given at the beginning and between Application image and Softdevice image while updating them at the same time.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pp_file</td><td>Reference to PStorage File.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, an error_code otherwise. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gae0963941e3ae5cb8df975c2be3cc857a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t iot_dfu_firmware_apply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00131.html">iot_dfu_firmware_desc_t</a> *&#160;</td>
          <td class="paramname"><em>p_firmware_desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for rebooting device and trigger bootloader to swap the new firmware. </p>
<dl class="section note"><dt>Note</dt><dd>Currently the following combinations are allowed:<ul>
<li>Application</li>
<li>Bootloader</li>
<li>SoftDevice with Application</li>
<li>SoftDevice with Bootloader</li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_firmware_desc</td><td>Description of the firmware. Must have been set to zeros on all unused fields.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="gaadbe1106a191a7c388ec892c7741c273"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t iot_dfu_firmware_validate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00131.html">iot_dfu_firmware_desc_t</a> *&#160;</td>
          <td class="paramname"><em>p_firmware_desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for validating the CRC of the received image. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_firmware_desc</td><td>Description of the firmware. Must have been set to zeros on all unused fields.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, an error_code otherwise. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga6f7d51e2bc30b7a77152cf42defc887d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t iot_dfu_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00406.html#ga8996135a268d6b7f19c520db0cce6ff4">iot_dfu_callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for initializing IOT DFU module. </p>
<dl class="section note"><dt>Note</dt><dd>The iot_dfu does not hold any state. The application must ensure that only one firmware image is written at once. Remember to register pstorage event handler to allow IoT File module to work.</dd></dl>
<p>err_code = softdevice_sys_evt_handler_set(sys_evt_dispatch); APP_ERROR_CHECK(err_code);</p>
<p>static void sys_evt_dispatch(uint32_t sys_evt) { pstorage_sys_event_handler(sys_evt); }</p>
<p>err_code = pstorage_init(); APP_ERROR_CHECK(err_code);</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>Callback to be called upon IoT file write success and failure, or any IoT DFU error event.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, an error_code otherwise. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Nov 27 2015 13:40:50 for nRF5 IoT SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
